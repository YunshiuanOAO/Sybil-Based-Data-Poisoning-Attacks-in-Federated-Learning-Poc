# 🎯 Sybil 攻擊工具使用說明

## 📁 項目結構

```
sybil-attack/
├── environment.py      # 聯邦學習環境模組
├── attack.py          # 攻擊策略模組  
├── setup.py           # 環境設置模組
├── main.py            # 主執行腳本
├── config.py          # 配置文件
├── requirements.txt   # 依賴項列表
└── 使用說明.md        # 本文件
```

## 🚀 快速開始

### 步驟 1: 環境設置

```bash
# 1. 檢查環境（推薦先執行）
python setup.py

# 2. 如果有缺失依賴，安裝它們
pip install torch torchvision numpy

# 或者使用 requirements.txt
pip install -r requirements.txt
```

### 步驟 2: 運行攻擊模擬

```bash
# 使用默認設置運行
python main.py

# 選擇特定攻擊場景
python main.py --scenario aggressive

# 自定義參數
python main.py --honest-clients 8 --sybil-clients 4 --rounds 15
```

## 📋 詳細使用方法

### 🔧 環境設置

`setup.py` 模組負責環境初始化：

```bash
# 完整環境檢查
python setup.py

# 僅檢查環境（不執行攻擊）
python main.py --setup-only
```

設置過程包括：
- ✅ 檢查系統依賴項
- ✅ 創建數據目錄  
- ✅ 測試 PyTorch 功能
- ✅ 驗證模組導入

### 🎯 攻擊腳本

`main.py` 是主執行入口，支持多種命令行參數：

#### 基本用法

```bash
# 默認中等攻擊場景
python main.py

# 顯示幫助信息
python main.py --help
```

#### 攻擊場景選擇

```bash
# 溫和攻擊（較晚開始，影響較小）
python main.py --scenario mild

# 中等攻擊（中期開始，平衡影響）[默認]
python main.py --scenario moderate  

# 激進攻擊（早期開始，持續時間長）
python main.py --scenario aggressive

# 隱蔽攻擊（很晚才開始，難以被發現）
python main.py --scenario stealth
```

#### 自定義參數

```bash
# 設置客戶端數量
python main.py --honest-clients 10 --sybil-clients 5

# 設置訓練輪數和攻擊開始輪數
python main.py --rounds 20 --start-round 5

# 設置投毒比例
python main.py --poison-ratio 0.5

# 指定輸出文件
python main.py --output my_attack_results.json

# 靜默模式（減少輸出）
python main.py --quiet
```

#### 完整參數列表

| 參數 | 說明 | 默認值 |
|------|------|--------|
| `--scenario` | 攻擊場景 (mild/moderate/aggressive/stealth) | moderate |
| `--rounds` | 訓練輪數 | 場景決定 |
| `--start-round` | 攻擊開始輪數 | 場景決定 |
| `--honest-clients` | 誠實客戶端數量 | 5 |
| `--sybil-clients` | Sybil 客戶端數量 | 3 |
| `--poison-ratio` | 投毒比例 (0.0-1.0) | 0.3 |
| `--output` | 結果輸出文件名 | 自動生成 |
| `--quiet` | 靜默模式 | False |
| `--setup-only` | 僅進行環境檢查 | False |

## 🏗️ 模組說明

### 📦 environment.py

包含聯邦學習環境的核心組件：

- `FederatedLearningEnvironment`: 聯邦學習環境類
- `HonestClient`: 誠實客戶端類
- `SybilClient`: Sybil 惡意客戶端類
- `SimpleNN`: 神經網絡模型
- `PoisonedDataset`: 投毒數據集類

```python
from environment import FederatedLearningEnvironment

# 創建環境
env = FederatedLearningEnvironment(
    num_honest_clients=5,
    num_sybil_clients=3,
    poison_ratio=0.3
)
```

### ⚔️ attack.py

包含攻擊策略和編排功能：

- `SybilAttackOrchestrator`: 攻擊編排器
- `ATTACK_SCENARIOS`: 預定義攻擊場景
- 聯邦平均算法
- 攻擊效果分析

```python
from attack import SybilAttackOrchestrator

# 創建攻擊編排器
orchestrator = SybilAttackOrchestrator(env)

# 運行攻擊模擬
results = orchestrator.run_attack_simulation(
    total_rounds=12,
    attack_start_round=3
)
```

### ⚙️ setup.py

環境設置和驗證：

- `EnvironmentSetup`: 環境設置類
- `quick_setup()`: 快速設置函數
- `validate_environment()`: 環境驗證函數

```python
from setup import quick_setup

# 執行環境設置
success, config = quick_setup()
```

## 📊 結果輸出

攻擊完成後會生成：

1. **控制台輸出**: 實時進度和結果分析
2. **JSON 結果文件**: 詳細的攻擊數據和統計
3. **文字可視化**: 攻擊進度條形圖

### 結果文件格式

```json
{
  "environment_info": {
    "num_honest_clients": 5,
    "num_sybil_clients": 3,
    "sybil_ratio": 0.375
  },
  "attack_effectiveness": {
    "max_accuracy_drop": 0.0332,
    "avg_attack_impact": 0.0289,
    "effectiveness_level": "低效"
  },
  "training_history": [...]
}
```

## 🔍 常見使用場景

### 場景 1: 基礎攻擊測試

```bash
# 使用默認設置進行快速測試
python main.py
```

### 場景 2: 不同攻擊強度比較

```bash
# 測試不同場景
python main.py --scenario mild --output mild_attack.json
python main.py --scenario aggressive --output aggressive_attack.json
```

### 場景 3: 參數敏感性分析

```bash
# 測試不同 Sybil 比例
python main.py --sybil-clients 2 --output low_sybil.json
python main.py --sybil-clients 6 --output high_sybil.json

# 測試不同投毒比例
python main.py --poison-ratio 0.1 --output low_poison.json
python main.py --poison-ratio 0.5 --output high_poison.json
```

### 場景 4: 大規模實驗

```bash
# 更多客戶端和更長訓練
python main.py --honest-clients 20 --sybil-clients 10 --rounds 30
```

## ⚠️ 注意事項

### 系統要求

- Python 3.7+
- PyTorch 1.8+
- 至少 2GB 可用內存
- 建議使用 GPU（可選）

### 運行時間

- 默認設置: 約 2-5 分鐘
- 大規模實驗: 可能需要 10-30 分鐘

### 故障排除

1. **導入錯誤**: 確保所有模組在同一目錄
2. **依賴缺失**: 運行 `python setup.py` 檢查
3. **內存不足**: 減少客戶端數量或批大小
4. **CUDA 錯誤**: 可以在 CPU 模式下運行

## 🔬 研究使用

### 自定義實驗

可以修改以下文件進行自定義研究：

- `config.py`: 調整默認參數
- `environment.py`: 修改客戶端行為或數據分布
- `attack.py`: 實現新的攻擊策略
- `main.py`: 添加新的實驗選項

### 批量實驗示例

```bash
#!/bin/bash
# 批量實驗腳本

# 測試不同 Sybil 比例
for sybil in 2 4 6 8; do
    python main.py --sybil-clients $sybil --output "sybil_${sybil}.json" --quiet
done

# 測試不同攻擊場景
for scenario in mild moderate aggressive stealth; do
    python main.py --scenario $scenario --output "${scenario}_attack.json" --quiet
done
```

## 📚 進階使用

### 程式化使用

```python
# 直接使用模組進行程式化控制
from environment import FederatedLearningEnvironment
from attack import SybilAttackOrchestrator

# 創建環境
env = FederatedLearningEnvironment(
    num_honest_clients=10,
    num_sybil_clients=5
)

# 創建攻擊器
attacker = SybilAttackOrchestrator(env)

# 逐步執行攻擊
for round_num in range(15):
    result = attacker.execute_training_round()
    print(f"Round {round_num}: Accuracy = {result['accuracy']:.4f}")

# 分析結果
effectiveness = attacker.analyze_attack_effectiveness()
print(f"Attack effectiveness: {effectiveness['effectiveness_level']}")
```

## 📄 輸出文件管理

結果文件會自動保存為 JSON 格式，包含時間戳。您可以：

1. **指定文件名**: `--output custom_name.json`
2. **組織實驗結果**: 創建子目錄存放不同實驗
3. **數據分析**: 使用 Python 或其他工具分析 JSON 結果

這個模組化的設計讓您可以：
- 🔧 獨立進行環境設置
- ⚔️ 靈活配置攻擊參數  
- 📊 方便分析實驗結果
- 🔬 支持大規模研究實驗 